<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>All-in-One Image Tool</title>
  <link rel="stylesheet" href="styles.css" />
  <script src="https://cdn.jsdelivr.net/npm/compressorjs@1.2.1/dist/compressor.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/pica@8.0.0/dist/pica.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/merge-images"></script>
  <style>
    .preview-container img {
      max-width: 100%;
      margin-top: 10px;
    }
    .social-icons img {
      height: 32px;
      width: 32px;
      margin: 5px;
      box-shadow: none;
    }
    .tool-box {
      margin-bottom: 20px;
    }
  </style>
</head>
<body>
  <h1>Welcome to the All-in-One Free Image Tool</h1>
  <p>Remove backgrounds, compress, resize, or merge images easily from any device!</p>

  <div class="tool-box">
    <h2>Image Resizer</h2>
    <input type="file" id="resizeInput" />
    <input type="number" id="resizeWidth" placeholder="Width" />
    <input type="number" id="resizeHeight" placeholder="Height" />
    <button onclick="resizeImage()">Resize</button>
    <button onclick="resetTool('resizeInput')">New Task</button>
    <div class="preview-container" id="resizePreview"></div>
  </div>

  <div class="tool-box">
    <h2>Image Compressor</h2>
    <input type="file" id="compressInput" />
    <input type="range" id="quality" min="0.1" max="1" step="0.1" value="0.8"> Quality
    <button onclick="compressImage()">Compress</button>
    <button onclick="resetTool('compressInput')">New Task</button>
    <div class="preview-container" id="compressPreview"></div>
  </div>

  <div class="tool-box">
    <h2>Merge Images</h2>
    <input type="file" id="mergeInput1" />
    <input type="file" id="mergeInput2" />
    <label><input type="radio" name="direction" value="horizontal" checked /> Horizontal</label>
    <label><input type="radio" name="direction" value="vertical" /> Vertical</label>
    <label>Border: <input type="color" id="borderColor" value="#ffffff" /></label>
    <button onclick="mergeImagesTool()">Merge</button>
    <button onclick="resetTool('mergeInput1', 'mergeInput2')">New Task</button>
    <div class="preview-container" id="mergePreview"></div>
  </div>

  <div class="social-icons">
    <a href="#"><img src="facebook.png" alt="Facebook"></a>
    <a href="#"><img src="twitter.png" alt="Twitter"></a>
    <a href="#"><img src="instagram.png" alt="Instagram"></a>
  </div>

  <script>
    function resetTool(...ids) {
      ids.forEach(id => document.getElementById(id).value = "");
      document.querySelectorAll('.preview-container').forEach(el => el.innerHTML = '');
    }

    function resizeImage() {
      const file = document.getElementById('resizeInput').files[0];
      const width = parseInt(document.getElementById('resizeWidth').value);
      const height = parseInt(document.getElementById('resizeHeight').value);
      if (!file || !width || !height) return alert('Provide all inputs');

      const img = new Image();
      const reader = new FileReader();
      reader.onload = e => {
        img.onload = () => {
          const canvas = document.createElement('canvas');
          canvas.width = width;
          canvas.height = height;
          const ctx = canvas.getContext('2d');
          ctx.drawImage(img, 0, 0, width, height);
          const dataUrl = canvas.toDataURL('image/png');
          document.getElementById('resizePreview').innerHTML = `<img src="${dataUrl}"><a download="resized.png" href="${dataUrl}">Download</a>`;
        }
        img.src = e.target.result;
      }
      reader.readAsDataURL(file);
    }

    function compressImage() {
      const file = document.getElementById('compressInput').files[0];
      const quality = parseFloat(document.getElementById('quality').value);
      if (!file || !quality) return alert('Provide file and quality');

      new Compressor(file, {
        quality: quality,
        success(result) {
          const reader = new FileReader();
          reader.onload = () => {
            document.getElementById('compressPreview').innerHTML = `<img src="${reader.result}"><a download="compressed.jpg" href="${reader.result}">Download</a>`;
          }
          reader.readAsDataURL(result);
        },
        error(err) {
          alert('Compression failed: ' + err.message);
        }
      });
    }

    function mergeImagesTool() {
      const files = [
        document.getElementById('mergeInput1').files[0],
        document.getElementById('mergeInput2').files[0]
      ];
      const direction = document.querySelector('input[name="direction"]:checked').value;
      const borderColor = document.getElementById('borderColor').value;
      if (!files[0] || !files[1]) return alert('Upload both images');

      Promise.all(files.map(f => new Promise(resolve => {
        const reader = new FileReader();
        reader.onload = () => resolve(reader.result);
        reader.readAsDataURL(f);
      }))).then(imgData => {
        mergeImages(imgData, {
          direction,
          margin: 10,
          backgroundColor: borderColor
        }).then(b64 => {
          document.getElementById('mergePreview').innerHTML = `<img src="${b64}"><a download="merged.png" href="${b64}">Download</a>`;
        });
      });
    }
  </script>
</body>
</html>
