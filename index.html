<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MultiTool Web App - Image Tools</title>
    <meta name="description" content="A single page web application with Image Compressor, Resizer, and Merger tools.">

    <!-- Open Graph / Facebook Meta Tags for Social Sharing Preview -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://yourwebsite.com/"> <!-- IMPORTANT: Replace with your actual website URL -->
    <meta property="og:title" content="MultiTool Web App - Image Tools">
    <meta property="og:description" content="Compress, Resize, and Merge Images Online for Free!">
    <meta property="og:image" content="https://yourwebsite.com/preview-image.jpg"> <!-- IMPORTANT: Replace with a URL to your preview image -->

    <!-- Twitter Meta Tags for Social Sharing Preview -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://yourwebsite.com/"> <!-- IMPORTANT: Replace with your actual website URL -->
    <meta property="twitter:title" content="MultiTool Web App - Image Tools">
    <meta property="twitter:description" content="Compress, Resize, and Merge Images Online for Free!">
    <meta property="twitter:image" content="https://yourwebsite.com/preview-image.jpg"> <!-- IMPORTANT: Replace with a URL to your preview image -->

    <style>
        /* Basic Reset & Body Styling */
        body {
            font-family: 'Arial', sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f4f7f6;
            color: #333;
            line-height: 1.6;
            display: flex;
            flex-direction: column;
            min-height: 100vh; /* Ensures footer sticks to bottom */
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            width: 100%; /* Ensure container takes full width on small screens */
            box-sizing: border-box; /* Include padding in element's total width and height */
        }

        /* Header */
        header {
            background-color: #2c3e50;
            color: white;
            padding: 15px 0;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }

        header .container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap; /* Allows wrapping on smaller screens */
        }

        .logo {
            font-size: 2em;
            font-weight: bold;
            color: white;
            text-decoration: none;
            margin-right: 20px;
        }

        nav ul {
            list-style: none;
            margin: 0;
            padding: 0;
            display: flex;
            flex-wrap: wrap; /* Allows wrapping for nav items */
            justify-content: center; /* Center align nav items on wrap */
        }

        nav ul li {
            margin: 0 10px; /* Adjusted margin for better spacing on mobile */
        }

        nav ul li a {
            color: white;
            text-decoration: none;
            padding: 8px 15px; /* Increased padding for easier tapping */
            transition: background-color 0.3s ease;
            border-radius: 4px;
            display: block; /* Makes the entire padding area clickable */
        }

        nav ul li a:hover {
            background-color: #34495e;
        }

        /* Responsive Header Adjustment */
        @media (max-width: 768px) {
            header .container {
                flex-direction: column;
                text-align: center;
            }
            .logo {
                margin-bottom: 15px;
                margin-right: 0;
            }
            nav ul {
                flex-direction: column;
                width: 100%;
            }
            nav ul li {
                margin: 5px 0;
            }
        }

        /* Welcome Banner */
        #welcome-banner {
            background-color: #3498db;
            color: white;
            padding: 60px 20px;
            text-align: center;
            margin-bottom: 30px;
            box-shadow: inset 0 -3px 5px rgba(0,0,0,0.1);
        }

        #welcome-banner h1 {
            font-size: 2.8em;
            margin-bottom: 15px;
            word-break: break-word; /* Prevents long words from overflowing on small screens */
        }

        #welcome-banner p {
            font-size: 1.2em;
            max-width: 800px;
            margin: 0 auto;
        }

        /* Tool Selection */
        #tool-selection {
            text-align: center;
            margin-bottom: 40px;
        }

        .tool-buttons {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 20px; /* Space between buttons */
        }

        .tool-button {
            background-color: #2ecc71;
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 1.1em;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.2s ease;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            min-width: 200px;
            text-align: center;
        }

        .tool-button:hover {
            background-color: #27ae60;
            transform: translateY(-2px);
        }

        /* Tool Sections */
        #tool-sections {
            margin-bottom: 40px;
            padding: 20px;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            display: none; /* Hidden by default, shown by JS */
            border: 1px solid #ddd;
        }

        .tool-section {
            padding: 30px 0;
            border-bottom: 1px solid #eee;
            margin-bottom: 30px;
        }

        .tool-section:last-child {
            border-bottom: none;
            margin-bottom: 0;
        }

        .tool-section h2 {
            color: #34495e;
            font-size: 2em;
            margin-bottom: 25px;
            text-align: center;
        }

        .tool-section p {
            text-align: center;
            margin-bottom: 25px;
            color: #666;
        }

        .tool-input-group {
            margin-bottom: 20px;
            display: flex;
            flex-direction: column;
            align-items: center; /* Center inputs */
        }

        .tool-input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #555;
            text-align: center;
        }

        .tool-input-group input[type="file"],
        .tool-input-group input[type="range"],
        .tool-input-group input[type="number"],
        .tool-input-group input[type="color"],
        .tool-input-group select {
            width: 100%;
            max-width: 400px;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            font-size: 1em;
            box-sizing: border-box; /* Include padding in width */
        }

        /* Range slider styling for cross-browser consistency */
        .tool-input-group input[type="range"] {
            -webkit-appearance: none;
            width: 100%;
            height: 8px;
            background: #d3d3d3;
            outline: none;
            opacity: 0.7;
            transition: opacity .2s;
            border-radius: 5px;
        }

        .tool-input-group input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            background: #3498db;
            cursor: pointer;
            border-radius: 50%;
        }

        .tool-input-group input[type="range"]::-moz-range-thumb {
            width: 20px;
            height: 20px;
            background: #3498db;
            cursor: pointer;
            border-radius: 50%;
        }

        .preview-area {
            margin-top: 30px;
            text-align: center;
            background-color: #f9f9f9;
            border: 1px dashed #ccc;
            padding: 20px;
            border-radius: 8px;
            min-height: 150px; /* Ensure some visible area even without preview */
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .preview-area img, .preview-area canvas {
            max-width: 100%;
            height: auto;
            border-radius: 5px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-top: 15px;
            display: block; /* Ensures it takes up full width for proper scaling */
            margin-left: auto;
            margin-right: auto;
        }

        .download-btn {
            background-color: #e67e22;
            color: white;
            border: none;
            padding: 12px 25px;
            font-size: 1.1em;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s ease;
            margin-top: 20px;
            text-decoration: none;
            display: inline-block; /* For download links */
        }

        .download-btn:hover {
            background-color: #d35400;
        }

        /* Features Section */
        #features {
            padding: 40px 0;
            background-color: #ecf0f1;
            margin-top: 40px;
            border-radius: 8px;
            box-shadow: 0 -2px 8px rgba(0,0,0,0.05);
        }

        #features h2 {
            text-align: center;
            font-size: 2.5em;
            color: #2c3e50;
            margin-bottom: 40px;
        }

        .feature-item {
            background-color: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            margin-bottom: 25px; /* For mobile stacking */
            text-align: center;
        }

        .feature-item h3 {
            color: #3498db;
            margin-bottom: 15px;
            font-size: 1.8em;
        }

        .feature-item p {
            color: #666;
            font-size: 1.1em;
        }

        /* Responsive grid for features */
        .features-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); /* Adjusted min-width for better mobile fit */
            gap: 25px;
        }

        /* Footer */
        footer {
            background-color: #2c3e50;
            color: white;
            padding: 30px 0;
            text-align: center;
            margin-top: auto; /* Pushes footer to the bottom */
            box-shadow: 0 -2px 5px rgba(0,0,0,0.2);
        }

        footer .container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
        }

        .footer-nav ul, .social-links ul {
            list-style: none;
            margin: 0;
            padding: 0;
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 15px;
        }

        .footer-nav a, .social-links a {
            color: white;
            text-decoration: none;
            padding: 5px 10px;
            transition: color 0.3s ease;
            font-size: 0.95em;
            display: flex; /* For social icons and text */
            align-items: center;
            gap: 5px; /* Space between icon and text */
        }

        .footer-nav a:hover, .social-links a:hover {
            color: #3498db;
        }

        /* Social media icons - uses Material Icons */
        .social-links {
            margin-top: 10px;
        }

        .social-links .material-icons {
            font-size: 1.5em; /* Icon size */
        }

        /* Utility classes */
        .hidden {
            display: none !important;
        }

        /* Specific styles for merge tool inputs */
        .merge-options-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); /* Adjusted min-width for better fit */
            gap: 20px;
            margin-bottom: 20px;
            justify-content: center;
        }

        .merge-options-grid .tool-input-group {
            margin-bottom: 0; /* Remove extra margin from individual groups in grid */
        }

        /* Style for the aspect ratio lock checkbox label */
        #aspect-ratio-lock + label {
            display: inline-block;
            margin-left: 5px;
            margin-bottom: 0; /* Override default margin-bottom */
            font-weight: normal; /* Override bold from .tool-input-group label */
        }

        /* Style for the checkbox itself to align better */
        #aspect-ratio-lock {
            width: auto; /* Allow checkbox to take natural width */
            margin-right: 0; /* Adjust as needed */
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <a href="#" class="logo">MultiTool App</a>
            <nav>
                <ul>
                    <li><a href="#" onclick="scrollToSection('welcome-banner'); return false;">Home</a></li>
                    <li><a href="https://example.com/contact" target="_blank" rel="noopener noreferrer">Contact</a></li>
                    <li><a href="https://example.com/support" target="_blank" rel="noopener noreferrer">Support</a></li>
                    <li><a href="https://example.com/download-app" target="_blank" rel="noopener noreferrer">Download <span class="material-icons">android</span> App</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <main>
        <section id="welcome-banner">
            <div class="container">
                <h1>Welcome to MultiTool Web App!</h1>
                <p>Your ultimate online destination for all your image manipulation needs. Easily compress, resize, and merge images with our powerful yet simple tools, designed for high quality and efficiency across all your devices.</p>
            </div>
        </section>

        <section id="tool-selection" class="container">
            <h2>Select Your Tool</h2>
            <div class="tool-buttons">
                <button class="tool-button" data-tool="compressor">Image Compressor</button>
                <button class="tool-button" data-tool="resizer">Image Resizer</button>
                <button class="tool-button" data-tool="merger">Merge Images</button>
            </div>
        </section>

        <section id="tool-sections" class="container hidden">
            <!-- Image Compressor Tool -->
            <div id="compressor-tool" class="tool-section hidden">
                <h2>Image Compressor</h2>
                <p>Reduce the file size of your images without significant loss of quality.</p>
                <div class="tool-input-group">
                    <label for="compress-image-input">Upload Image:</label>
                    <input type="file" id="compress-image-input" accept="image/*">
                </div>
                <div class="tool-input-group">
                    <label for="compression-quality">Compression Quality: <span id="quality-value">80</span>%</label>
                    <input type="range" id="compression-quality" min="10" max="100" value="80">
                </div>
                <div class="preview-area">
                    <p>Preview Compressed Image:</p>
                    <img id="compressed-preview" src="" alt="Compressed Image Preview" class="hidden">
                    <canvas id="compress-canvas" class="hidden"></canvas>
                    <p id="compressed-info"></p>
                    <a id="download-compressed-btn" class="download-btn hidden" download="compressed-image.jpg">Download Compressed Image</a>
                </div>
            </div>

            <!-- Image Resizer Tool -->
            <div id="resizer-tool" class="tool-section hidden">
                <h2>Image Resizer</h2>
                <p>Change the dimensions of your images while maintaining quality and aspect ratio.</p>
                <div class="tool-input-group">
                    <label for="resize-image-input">Upload Image:</label>
                    <input type="file" id="resize-image-input" accept="image/*">
                </div>
                <div class="tool-input-group">
                    <label for="resize-width">New Width (pixels):</label>
                    <input type="number" id="resize-width" placeholder="e.g., 800" min="1">
                </div>
                <div class="tool-input-group">
                    <label for="resize-height">New Height (pixels):</label>
                    <input type="number" id="resize-height" placeholder="e.g., 600" min="1">
                </div>
                <div class="tool-input-group" style="flex-direction: row; align-items: center; justify-content: center;">
                    <input type="checkbox" id="aspect-ratio-lock" checked>
                    <label for="aspect-ratio-lock">Lock Aspect Ratio</label>
                </div>
                <div class="preview-area">
                    <p>Preview Resized Image:</p>
                    <img id="resized-preview" src="" alt="Resized Image Preview" class="hidden">
                    <canvas id="resize-canvas" class="hidden"></canvas>
                    <p id="resized-info"></p>
                    <a id="download-resized-btn" class="download-btn hidden" download="resized-image.jpg">Download Resized Image</a>
                </div>
            </div>

            <!-- Merge Images Tool -->
            <div id="merger-tool" class="tool-section hidden">
                <h2>Merge Images</h2>
                <p>Combine multiple images into one, with options for borders and backgrounds.</p>
                <div class="tool-input-group">
                    <label for="merge-image-input1">Upload Image 1:</label>
                    <input type="file" id="merge-image-input1" accept="image/*">
                </div>
                <div class="tool-input-group">
                    <label for="merge-image-input2">Upload Image 2:</label>
                    <input type="file" id="merge-image-input2" accept="image/*">
                </div>
                <div class="merge-options-grid">
                    <div class="tool-input-group">
                        <label for="merge-border-size">Border Size (pixels):</label>
                        <input type="number" id="merge-border-size" value="0" min="0">
                    </div>
                    <div class="tool-input-group">
                        <label for="merge-border-color">Border Color:</label>
                        <input type="color" id="merge-border-color" value="#000000">
                    </div>
                    <div class="tool-input-group">
                        <label for="merge-background-color">Background Color:</label>
                        <input type="color" id="merge-background-color" value="#FFFFFF">
                    </div>
                    <div class="tool-input-group">
                        <label for="merge-orientation">Merge Orientation:</label>
                        <select id="merge-orientation">
                            <option value="horizontal">Horizontal</option>
                            <option value="vertical">Vertical</option>
                        </select>
                    </div>
                </div>
                <div class="preview-area">
                    <p>Preview Merged Image:</p>
                    <img id="merged-preview" src="" alt="Merged Image Preview" class="hidden">
                    <canvas id="merge-canvas" class="hidden"></canvas>
                    <a id="download-merged-btn" class="download-btn hidden" download="merged-image.jpg">Download Merged Image</a>
                </div>
            </div>
        </section>

        <section id="features" class="container">
            <h2>Features of Our Tools</h2>
            <div class="features-grid">
                <div class="feature-item">
                    <h3>Image Compressor</h3>
                    <p>Reduce image file sizes for faster loading times and easier sharing. Our compressor intelligently optimizes images while preserving visual quality, perfect for web use and email attachments. Supports JPEG and PNG formats efficiently.</p>
                </div>
                <div class="feature-item">
                    <h3>Image Resizer</h3>
                    <p>Effortlessly adjust image dimensions to fit any requirement without compromising clarity. Resize for social media, print, or web banners with precise control over width, height, and an option to lock aspect ratio for perfect scaling.</p>
                </div>
                <div class="feature-item">
                    <h3>Merge Images</h3>
                    <p>Combine multiple photos into a single, cohesive image. Create stunning collages or side-by-side comparisons with customizable borders, background colors, and flexible layouts. Ideal for storytelling or presenting visual information.</p>
                </div>
            </div>
        </section>
    </main>

    <footer>
        <div class="container">
            <div class="footer-nav">
                <ul>
                    <li><a href="https://example.com/privacy" target="_blank" rel="noopener noreferrer">Privacy Policy</a></li>
                    <li><a href="https://example.com/terms" target="_blank" rel="noopener noreferrer">Terms & Conditions</a></li>
                </ul>
            </div>
            <div class="social-links">
                <ul>
                    <li><a href="https://facebook.com/yourpage" target="_blank" rel="noopener noreferrer"><span class="material-icons">facebook</span> Facebook</a></li>
                    <li><a href="https://instagram.com/yourpage" target="_blank" rel="noopener noreferrer"><span class="material-icons">camera_alt</span> Instagram</a></li> <!-- Using camera_alt for Instagram -->
                    <li><a href="https://linkedin.com/in/yourprofile" target="_blank" rel="noopener noreferrer"><span class="material-icons">linkedin</span> LinkedIn</a></li> <!-- No direct LinkedIn icon, using placeholder-->
                    <li><a href="https://youtube.com/yourchannel" target="_blank" rel="noopener noreferrer"><span class="material-icons">youtube_activity</span> YouTube</a></li> <!-- No direct YouTube icon, using placeholder-->
                </ul>
            </div>
            <p>Â© 2023 MultiTool App. All rights reserved.</p>
        </div>
    </footer>

    <script>
        // --- Global Utility Functions and Elements ---

        // Smooth scrolling for Home button
        function scrollToSection(id) {
            document.getElementById(id).scrollIntoView({ behavior: 'smooth' });
        }

        // Global elements for tool selection
        const toolButtons = document.querySelectorAll('.tool-button');
        const toolSectionsContainer = document.getElementById('tool-sections');
        const allToolSections = document.querySelectorAll('.tool-section');

        // Function to show a specific tool section and scroll to it
        function showToolSection(toolId) {
            allToolSections.forEach(section => section.classList.add('hidden')); // Hide all tool sections
            toolSectionsContainer.classList.remove('hidden'); // Show the main tool container
            document.getElementById(`${toolId}-tool`).classList.remove('hidden'); // Show the selected tool
            document.getElementById(`${toolId}-tool`).scrollIntoView({ behavior: 'smooth', block: 'start' }); // Scroll to it
        }

        // Event listeners for tool selection buttons
        toolButtons.forEach(button => {
            button.addEventListener('click', () => {
                const toolId = button.dataset.tool;
                showToolSection(toolId);
            });
        });

        // Helper to convert Data URL to Blob for size calculation
        function dataURLtoBlob(dataurl) {
            const arr = dataurl.split(',');
            const mime = arr[0].match(/:(.*?);/)[1];
            const bstr = atob(arr[1]);
            let n = bstr.length;
            const u8arr = new Uint8Array(n);
            while (n--) {
                u8arr[n] = bstr.charCodeAt(n);
            }
            return new Blob([u8arr], { type: mime });
        }

        // --- Image Compressor Logic ---
        const compressImageInput = document.getElementById('compress-image-input');
        const compressionQuality = document.getElementById('compression-quality');
        const qualityValueSpan = document.getElementById('quality-value');
        const compressedPreview = document.getElementById('compressed-preview');
        const compressCanvas = document.getElementById('compress-canvas');
        const downloadCompressedBtn = document.getElementById('download-compressed-btn');
        const compressedInfo = document.getElementById('compressed-info');

        let originalCompressImage = null; // Stores the original image object

        // Event listener for file input change
        compressImageInput.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (event) => {
                    originalCompressImage = new Image();
                    originalCompressImage.onload = () => {
                        compressImage(); // Once image is loaded, compress it
                    };
                    originalCompressImage.src = event.target.result; // Load image data
                };
                reader.readAsDataURL(file); // Read file as Data URL
            } else {
                // Clear preview if no file selected
                compressedPreview.classList.add('hidden');
                compressCanvas.classList.add('hidden');
                downloadCompressedBtn.classList.add('hidden');
                compressedInfo.textContent = '';
                originalCompressImage = null;
            }
        });

        // Event listener for quality slider change
        compressionQuality.addEventListener('input', () => {
            qualityValueSpan.textContent = compressionQuality.value; // Update quality display
            if (originalCompressImage) {
                compressImage(); // Re-compress with new quality
            }
        });

        // Main compression function
        function compressImage() {
            if (!originalCompressImage) return; // Exit if no image loaded

            const quality = parseFloat(compressionQuality.value) / 100; // Get quality as 0-1 float
            const ctx = compressCanvas.getContext('2d');

            // Set canvas dimensions to original image dimensions for drawing
            compressCanvas.width = originalCompressImage.naturalWidth;
            compressCanvas.height = originalCompressImage.naturalHeight;

            // Clear canvas and draw image
            ctx.clearRect(0, 0, compressCanvas.width, compressCanvas.height);
            ctx.drawImage(originalCompressImage, 0, 0);

            // Get compressed image data URL (JPEG format)
            const compressedDataUrl = compressCanvas.toDataURL('image/jpeg', quality);

            // Update preview image and download link
            compressedPreview.src = compressedDataUrl;
            compressedPreview.classList.remove('hidden');
            compressCanvas.classList.add('hidden'); // Hide canvas, show img tag
            downloadCompressedBtn.href = compressedDataUrl;
            downloadCompressedBtn.download = `compressed_image_${Date.now()}.jpg`; // Dynamic filename
            downloadCompressedBtn.classList.remove('hidden');

            // Calculate and display size difference
            const originalSize = compressImageInput.files[0].size;
            const compressedSize = dataURLtoBlob(compressedDataUrl).size;
            const reduction = originalSize > 0 ? ((originalSize - compressedSize) / originalSize * 100).toFixed(2) : 0;
            compressedInfo.textContent = `Original Size: ${(originalSize / 1024).toFixed(2)} KB | Compressed Size: ${(compressedSize / 1024).toFixed(2)} KB | Reduction: ${reduction}%`;
        }


        // --- Image Resizer Logic ---
        const resizeImageInput = document.getElementById('resize-image-input');
        const resizeWidthInput = document.getElementById('resize-width');
        const resizeHeightInput = document.getElementById('resize-height');
        const aspectRatioLock = document.getElementById('aspect-ratio-lock');
        const resizedPreview = document.getElementById('resized-preview');
        const resizeCanvas = document.getElementById('resize-canvas');
        const downloadResizedBtn = document.getElementById('download-resized-btn');
        const resizedInfo = document.getElementById('resized-info');

        let originalResizeImage = null;
        let currentImageAspectRatio = 1;

        // Event listener for file input change
        resizeImageInput.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (event) => {
                    originalResizeImage = new Image();
                    originalResizeImage.onload = () => {
                        // Set current aspect ratio and initial dimensions
                        currentImageAspectRatio = originalResizeImage.naturalWidth / originalResizeImage.naturalHeight;
                        resizeWidthInput.value = originalResizeImage.naturalWidth;
                        resizeHeightInput.value = originalResizeImage.naturalHeight;
                        resizeImage();
                    };
                    originalResizeImage.src = event.target.result;
                };
                reader.readAsDataURL(file);
            } else {
                // Clear preview if no file selected
                resizedPreview.classList.add('hidden');
                resizeCanvas.classList.add('hidden');
                downloadResizedBtn.classList.add('hidden');
                resizedInfo.textContent = '';
                originalResizeImage = null;
            }
        });

        // Event listeners for width/height input and aspect ratio lock
        resizeWidthInput.addEventListener('input', () => {
            if (aspectRatioLock.checked && originalResizeImage) {
                resizeHeightInput.value = Math.round(resizeWidthInput.value / currentImageAspectRatio);
            }
            if (originalResizeImage) resizeImage();
        });

        resizeHeightInput.addEventListener('input', () => {
            if (aspectRatioLock.checked && originalResizeImage) {
                resizeWidthInput.value = Math.round(resizeHeightInput.value * currentImageAspectRatio);
            }
            if (originalResizeImage) resizeImage();
        });

        aspectRatioLock.addEventListener('change', () => {
            if (aspectRatioLock.checked && originalResizeImage) {
                // When re-locking, adjust height based on current width to maintain ratio
                if (resizeWidthInput.value) {
                    resizeHeightInput.value = Math.round(resizeWidthInput.value / currentImageAspectRatio);
                } else if (resizeHeightInput.value) {
                     // If only height is set, adjust width
                     resizeWidthInput.value = Math.round(resizeHeightInput.value * currentImageAspectRatio);
                }
            }
            if (originalResizeImage) resizeImage();
        });

        // Main resizing function
        function resizeImage() {
            if (!originalResizeImage) return;

            let newWidth = parseInt(resizeWidthInput.value);
            let newHeight = parseInt(resizeHeightInput.value);

            // If both inputs are empty, default to original size
            if (!newWidth && !newHeight) {
                newWidth = originalResizeImage.naturalWidth;
                newHeight = originalResizeImage.naturalHeight;
            } else if (aspectRatioLock.checked) {
                // If aspect ratio is locked
                if (newWidth && !newHeight) {
                    newHeight = Math.round(newWidth / currentImageAspectRatio);
                } else if (newHeight && !newWidth) {
                    newWidth = Math.round(newHeight * currentImageAspectRatio);
                } else if (newWidth && newHeight) {
                    // If both are entered, prioritize width and adjust height to maintain ratio
                    newHeight = Math.round(newWidth / currentImageAspectRatio);
                }
            }

            // Fallback to original dimensions if computed dimensions are invalid
            if (isNaN(newWidth) || newWidth <= 0) newWidth = originalResizeImage.naturalWidth;
            if (isNaN(newHeight) || newHeight <= 0) newHeight = originalResizeImage.naturalHeight;

            // Update input fields with calculated values
            resizeWidthInput.value = newWidth;
            resizeHeightInput.value = newHeight;

            const ctx = resizeCanvas.getContext('2d');
            resizeCanvas.width = newWidth;
            resizeCanvas.height = newHeight;

            // Enable high-quality image smoothing for better resizing results
            ctx.imageSmoothingEnabled = true;
            ctx.imageSmoothingQuality = "high"; // 'low', 'medium', 'high'

            ctx.clearRect(0, 0, newWidth, newHeight);
            ctx.drawImage(originalResizeImage, 0, 0, newWidth, newHeight); // Draw image with new dimensions

            const resizedDataUrl = resizeCanvas.toDataURL('image/jpeg', 0.9); // High quality for resized image

            // Update preview and download link
            resizedPreview.src = resizedDataUrl;
            resizedPreview.classList.remove('hidden');
            resizeCanvas.classList.add('hidden');
            downloadResizedBtn.href = resizedDataUrl;
            downloadResizedBtn.download = `resized_image_${Date.now()}.jpg`;
            downloadResizedBtn.classList.remove('hidden');
            resizedInfo.textContent = `New Dimensions: ${newWidth}px x ${newHeight}px`;
        }


        // --- Merge Images Logic ---
        const mergeImageInput1 = document.getElementById('merge-image-input1');
        const mergeImageInput2 = document.getElementById('merge-image-input2');
        const mergeBorderSizeInput = document.getElementById('merge-border-size');
        const mergeBorderColorInput = document.getElementById('merge-border-color');
        const mergeBackgroundColorInput = document.getElementById('merge-background-color');
        const mergeOrientationSelect = document.getElementById('merge-orientation');
        const mergedPreview = document.getElementById('merged-preview');
        const mergeCanvas = document.getElementById('merge-canvas');
        const downloadMergedBtn = document.getElementById('download-merged-btn');

        let img1 = null; // Stores the first image object
        let img2 = null; // Stores the second image object

        // Event listeners for image inputs and options
        mergeImageInput1.addEventListener('change', (e) => loadImageForMerge(e, 1));
        mergeImageInput2.addEventListener('change', (e) => loadImageForMerge(e, 2));
        mergeBorderSizeInput.addEventListener('input', mergeImages);
        mergeBorderColorInput.addEventListener('input', mergeImages);
        mergeBackgroundColorInput.addEventListener('input', mergeImages);
        mergeOrientationSelect.addEventListener('change', mergeImages);

        // Function to load an image for merging
        function loadImageForMerge(event, imgNum) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    const img = new Image();
                    img.onload = () => {
                        if (imgNum === 1) img1 = img;
                        else img2 = img;
                        mergeImages(); // Once loaded, attempt to merge
                    };
                    img.src = e.target.result;
                };
                reader.readAsDataURL(file);
            } else {
                // If a file is unselected, clear the corresponding image and re-merge
                if (imgNum === 1) img1 = null;
                else img2 = null;
                mergeImages();
            }
        }

        // Main merging function
        function mergeImages() {
            // Hide everything if no images are loaded
            if (!img1 && !img2) {
                mergedPreview.classList.add('hidden');
                mergeCanvas.classList.add('hidden');
                downloadMergedBtn.classList.add('hidden');
                return;
            }

            const borderSize = parseInt(mergeBorderSizeInput.value) || 0;
            const borderColor = mergeBorderColorInput.value;
            const backgroundColor = mergeBackgroundColorInput.value;
            const orientation = mergeOrientationSelect.value;

            const ctx = mergeCanvas.getContext('2d');
            ctx.clearRect(0, 0, mergeCanvas.width, mergeCanvas.height); // Clear canvas before drawing

            let totalWidth = 0;
            let totalHeight = 0;
            let currentX = 0;
            let currentY = 0;

            const imagesToDraw = [];
            if (img1) imagesToDraw.push(img1);
            if (img2) imagesToDraw.push(img2);

            if (imagesToDraw.length === 0) {
                mergedPreview.classList.add('hidden');
                mergeCanvas.classList.add('hidden');
                downloadMergedBtn.classList.add('hidden');
                return;
            }

            // Calculate dimensions for the merged canvas
            if (orientation === 'horizontal') {
                imagesToDraw.forEach(img => {
                    totalWidth += img.naturalWidth + (borderSize * 2);
                    totalHeight = Math.max(totalHeight, img.naturalHeight + (borderSize * 2));
                });
            } else { // vertical
                imagesToDraw.forEach(img => {
                    totalWidth = Math.max(totalWidth, img.naturalWidth + (borderSize * 2));
                    totalHeight += img.naturalHeight + (borderSize * 2);
                });
            }

            // Set canvas dimensions
            mergeCanvas.width = totalWidth;
            mergeCanvas.height = totalHeight;

            // Fill background
            ctx.fillStyle = backgroundColor;
            ctx.fillRect(0, 0, totalWidth, totalHeight);

            // Draw images with borders
            imagesToDraw.forEach(img => {
                // Draw border rectangle first
                ctx.fillStyle = borderColor;
                ctx.fillRect(currentX, currentY, img.naturalWidth + (borderSize * 2), img.naturalHeight + (borderSize * 2));

                // Draw image inside the border
                ctx.drawImage(img, currentX + borderSize, currentY + borderSize, img.naturalWidth, img.naturalHeight);

                // Update current position for next image
                if (orientation === 'horizontal') {
                    currentX += img.naturalWidth + (borderSize * 2);
                } else { // vertical
                    currentY += img.naturalHeight + (borderSize * 2);
                }
            });

            const mergedDataUrl = mergeCanvas.toDataURL('image/jpeg', 0.9); // Generate merged image as JPEG

            // Update preview and download link
            mergedPreview.src = mergedDataUrl;
            mergedPreview.classList.remove('hidden');
            mergeCanvas.classList.add('hidden');
            downloadMergedBtn.href = mergedDataUrl;
            downloadMergedBtn.download = `merged_image_${Date.now()}.jpg`;
            downloadMergedBtn.classList.remove('hidden');
        }

        // Dynamically add Material Icons stylesheet (for Android, Facebook, Instagram, LinkedIn, YouTube icon placeholders)
        // This ensures the icons appear even if you don't manually link the stylesheet in <head>
        const link = document.createElement('link');
        link.href = 'https://fonts.googleapis.com/icon?family=Material+Icons';
        link.rel = 'stylesheet';
        document.head.appendChild(link);
    </script>
</body>
</html>
